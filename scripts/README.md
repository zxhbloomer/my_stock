# Scripts ç›®å½•è¯´æ˜

æœ¬ç›®å½•åŒ…å«é¡¹ç›®çš„æ‰€æœ‰å·¥å…·è„šæœ¬ï¼ŒæŒ‰åŠŸèƒ½åˆ†ç±»ã€‚

  ä¼˜ç§€å› å­ (å¯ç›´æ¥ä½¿ç”¨):
  - |IC_mean| > 0.03
  - IR > 1.0
  - ICèƒœç‡ > 60%

  å¯ç”¨å› å­ (ç»„åˆä½¿ç”¨):
  - |IC_mean| > 0.01
  - IR > 0.5
  - ICèƒœç‡ > 55%

  æ·˜æ±°å› å­:
  - |IC_mean| < 0.01
  - IR < 0.2
  - ICèƒœç‡ < 50%


  # 1. ICåˆ†æï¼ˆç­›é€‰é«˜è´¨é‡å› å­ï¼‰
  python scripts/20_ICåˆ†æ.py

  # 2. è®­ç»ƒTopå› å­æ¨¡å‹å¹¶ç”Ÿæˆ50å› å­é…ç½®
  python scripts/22_è®­ç»ƒTopå› å­æ¨¡å‹_ç”Ÿæˆ50yaml.py

  # 3. å‚æ•°ä¼˜åŒ–ï¼ˆç”Ÿæˆä¼˜åŒ–åçš„æ–°YAMLé…ç½®ï¼‰
  python scripts/40_å‚æ•°ä¼˜åŒ–_ç”Ÿæˆæ–°yaml.py --config configs/workflow_config_top50.yaml --n-iter 30

  # 4. ä½¿ç”¨ä¼˜åŒ–åçš„é…ç½®è¿è¡Œå›æµ‹
  python scripts/30_è¿è¡Œå·¥ä½œæµ.py configs/workflow_config_top50_optimized.yaml

  # 5. æŸ¥çœ‹ç»“æœ
  python view_results.py


 ä½ çš„æ¨¡å‹è®­ç»ƒæ—¶é—´:
  - Train: 2008-2014 (7å¹´)
  - Valid: 2015-2016 (2å¹´)
  - Test: 2017-2020 (3.7å¹´)

  ä»Šå¤©æ—¥æœŸ: 2025-11-16

  ğŸ¯ æ¨èçš„æ»šåŠ¨çª—å£å‚æ•°

  æ ¹æ®Qlibæœ€ä½³å®è·µ,æˆ‘æ¨èä½¿ç”¨ä¸åŸè®­ç»ƒå‘¨æœŸä¸€è‡´çš„çª—å£å¤§å°:

python.exe scripts\50_æ»šåŠ¨çª—å£éªŒè¯.py --config configs\workflow_config_top50_optimized.yaml --train-years 7 --valid-years 2 --test-years 1 --start-year 2008 --end-year 2025

  ğŸ“‹ å‚æ•°è§£é‡Š

  | å‚æ•°            | å€¼    | ç†ç”±                   |
  |---------------|------|----------------------|
  | --train-years | 7    | ä¸åŸé…ç½®ä¸€è‡´(2008-2014å…±7å¹´) |
  | --valid-years | 2    | ä¸åŸé…ç½®ä¸€è‡´(2015-2016å…±2å¹´) |
  | --test-years  | 1    | æ¯å¹´æ»šåŠ¨ä¸€æ¬¡,æ›´ç»†ç²’åº¦è¯„ä¼°        |
  | --start-year  | 2008 | ä»æ•°æ®èµ·å§‹å¹´ä»½å¼€å§‹            |
  | --end-year    | 2025 | éªŒè¯åˆ°å½“å‰å¹´ä»½              |

  ğŸ”„ è¿™ä¼šç”Ÿæˆçš„æµ‹è¯•æœŸ

  Test_2017: è®­ç»ƒ2008-2014, éªŒè¯2015-2016, æµ‹è¯•2017
  Test_2018: è®­ç»ƒ2009-2015, éªŒè¯2016-2017, æµ‹è¯•2018
  Test_2019: è®­ç»ƒ2010-2016, éªŒè¯2017-2018, æµ‹è¯•2019
  Test_2020: è®­ç»ƒ2011-2017, éªŒè¯2018-2019, æµ‹è¯•2020
  Test_2021: è®­ç»ƒ2012-2018, éªŒè¯2019-2020, æµ‹è¯•2021
  Test_2022: è®­ç»ƒ2013-2019, éªŒè¯2020-2021, æµ‹è¯•2022
  Test_2023: è®­ç»ƒ2014-2020, éªŒè¯2021-2022, æµ‹è¯•2023
  Test_2024: è®­ç»ƒ2015-2021, éªŒè¯2022-2023, æµ‹è¯•2024
  Test_2025: è®­ç»ƒ2016-2022, éªŒè¯2023-2024, æµ‹è¯•2025

  å…±9ä¸ªæµ‹è¯•æœŸ, è¦†ç›–2017-2025å¹´æ‰€æœ‰æ•°æ®!


## ğŸ“‚ ç›®å½•ç»“æ„

```
scripts/
â”œâ”€â”€ result/                    # ğŸ“Š ç»“æœæŸ¥çœ‹å’Œåˆ†æå·¥å…·
â”‚   â”œâ”€â”€ README.md              # ä½¿ç”¨è¯´æ˜
â”‚   â”œâ”€â”€ æŸ¥çœ‹ç»“æœ.py            # ç»ˆç«¯æŸ¥çœ‹å›æµ‹ç»“æœ
â”‚   â”œâ”€â”€ ç”Ÿæˆå›¾è¡¨.py            # ç”ŸæˆPNGé™æ€å›¾è¡¨
â”‚   â”œâ”€â”€ ç”ŸæˆHTMLæŠ¥å‘Š.py        # ç”Ÿæˆäº¤äº’å¼HTMLæŠ¥å‘Š
â”‚   â””â”€â”€ æ£€æŸ¥æ•°æ®èŒƒå›´.py        # æ£€æŸ¥Qlibæ•°æ®æ—¶é—´èŒƒå›´
â”‚
â”œâ”€â”€ run/                       # ğŸ–¥ï¸ GUIè¿è¡Œå·¥å…·
â”‚   â””â”€â”€ run_gui.py             # å›¾å½¢ç•Œé¢å¯åŠ¨å™¨
â”‚
â”œâ”€â”€ 00_Tushareè½¬Qlib.py       # ğŸ“¥ Tushareæ•°æ®è½¬Qlibæ ¼å¼
â”œâ”€â”€ 10_æ£€æŸ¥ç¯å¢ƒ.py             # âœ… ç¯å¢ƒæ£€æŸ¥å·¥å…·
â”œâ”€â”€ 20_ICåˆ†æ.py               # ğŸ“ˆ å› å­ICåˆ†æï¼ˆä»255ä¸ªå› å­ç­›é€‰å¼ºå› å­ï¼‰
â”œâ”€â”€ 21_ä½¿ç”¨ICç»“æœ.py           # ğŸ“Š æŸ¥çœ‹å’Œä½¿ç”¨ICåˆ†æç»“æœ
â”œâ”€â”€ 22_è®­ç»ƒTopå› å­æ¨¡å‹.py      # ğŸš€ ç”¨Topå› å­ç”Ÿæˆé…ç½®å¹¶è®­ç»ƒ
â”œâ”€â”€ ä¸€é”®è¿è¡Œ.py                # âš¡ å®Œæ•´å·¥ä½œæµæ‰§è¡Œå™¨ï¼ˆè®­ç»ƒ+å›æµ‹+æŠ¥å‘Šï¼‰
â””â”€â”€ model_optimization.py      # ğŸ”§ æ¨¡å‹å‚æ•°ä¼˜åŒ–å·¥å…·
```

## ğŸ”¢ æ–‡ä»¶ç¼–å·è§„åˆ™

- **00-09**ï¼šæ•°æ®å‡†å¤‡å’Œç¯å¢ƒæ£€æŸ¥
- **10-19**ï¼šç¯å¢ƒå’Œå·¥å…·æ£€æŸ¥
- **20-29**ï¼šå› å­åˆ†æå’Œç­›é€‰
- **30+**ï¼šï¼ˆé¢„ç•™ï¼‰å…¶ä»–åŠŸèƒ½

## ğŸ“‹ æ ¸å¿ƒå·¥ä½œæµç¨‹

### **æ ‡å‡†æµç¨‹**ï¼ˆæ¨èï¼‰

```bash
# æ­¥éª¤1: æ£€æŸ¥ç¯å¢ƒ
python scripts/10_æ£€æŸ¥ç¯å¢ƒ.py

# æ­¥éª¤2: ICåˆ†æï¼ˆç­›é€‰å¼ºå› å­ï¼‰
python scripts/20_ICåˆ†æ.py

# æ­¥éª¤3: ç”ŸæˆTopå› å­é…ç½®
python scripts/22_è®­ç»ƒTopå› å­æ¨¡å‹.py --top 50

# æ­¥éª¤4: æ‰§è¡Œå®Œæ•´å·¥ä½œæµï¼ˆè®­ç»ƒ+å›æµ‹+æŠ¥å‘Šï¼‰
python scripts/ä¸€é”®è¿è¡Œ.py configs/workflow_config_top50.yaml
```

### **å¿«é€ŸæŸ¥çœ‹ç»“æœ**

```bash
# ç»ˆç«¯æŸ¥çœ‹
python scripts/result/æŸ¥çœ‹ç»“æœ.py

# ç”ŸæˆPNGå›¾è¡¨
python scripts/result/ç”Ÿæˆå›¾è¡¨.py

# ç”ŸæˆHTMLæŠ¥å‘Šï¼ˆæ¨èï¼‰
python scripts/result/ç”ŸæˆHTMLæŠ¥å‘Š.py
```

## ğŸ“– è¯¦ç»†è¯´æ˜

### **æ•°æ®å‡†å¤‡è„šæœ¬**

#### `00_Tushareè½¬Qlib.py`
**åŠŸèƒ½**ï¼šå°†Tushare Proæ•°æ®è½¬æ¢ä¸ºQlibæ ¼å¼
```bash
python scripts/00_Tushareè½¬Qlib.py
```
**è¾“å‡º**ï¼š`D:/Data/my_stock/` ç›®å½•ä¸‹çš„Qlibæ•°æ®

---

### **ç¯å¢ƒæ£€æŸ¥è„šæœ¬**

#### `10_æ£€æŸ¥ç¯å¢ƒ.py`
**åŠŸèƒ½**ï¼šæ£€æŸ¥Qlibã€æ•°æ®ã€ç¯å¢ƒæ˜¯å¦æ­£å¸¸
```bash
python scripts/10_æ£€æŸ¥ç¯å¢ƒ.py
```
**æ£€æŸ¥é¡¹**ï¼š
- Qlibæ˜¯å¦å®‰è£…
- æ•°æ®è·¯å¾„æ˜¯å¦å­˜åœ¨
- æ•°æ®æ—¶é—´èŒƒå›´
- Pythonç¯å¢ƒå’Œä¾èµ–

---

### **å› å­åˆ†æè„šæœ¬**

#### `20_ICåˆ†æ.py`
**åŠŸèƒ½**ï¼šè®¡ç®—255ä¸ªå› å­çš„ICå€¼ï¼Œç­›é€‰å¼ºå› å­
```bash
python scripts/20_ICåˆ†æ.py
```
**å‚æ•°**ï¼š
- `--pool`ï¼šè‚¡ç¥¨æ± ï¼ˆcsi300/csi500ï¼Œé»˜è®¤csi300ï¼‰
- `--start`ï¼šå¼€å§‹æ—¶é—´ï¼ˆé»˜è®¤2017-01-01ï¼‰
- `--end`ï¼šç»“æŸæ—¶é—´ï¼ˆé»˜è®¤2020-12-31ï¼‰
- `--threshold`ï¼šICé˜ˆå€¼ï¼ˆé»˜è®¤0.01ï¼‰

**è¾“å‡º**ï¼š
- MLflowå®éªŒè®°å½•ï¼š`mlruns/ic_analysis`
- ICæ’åºç»“æœï¼šä¿å­˜åœ¨å®éªŒä¸­

**ç¤ºä¾‹**ï¼š
```bash
# åœ¨CSI500ä¸Šåˆ†æ
python scripts/20_ICåˆ†æ.py --pool csi500

# è‡ªå®šä¹‰ICé˜ˆå€¼
python scripts/20_ICåˆ†æ.py --threshold 0.02
```

---

#### `21_ä½¿ç”¨ICç»“æœ.py`
**åŠŸèƒ½**ï¼šæŸ¥çœ‹å’Œå¯¼å‡ºICåˆ†æç»“æœ
```bash
python scripts/21_ä½¿ç”¨ICç»“æœ.py
```
**è¾“å‡º**ï¼š
- æ˜¾ç¤ºTopå› å­åˆ—è¡¨
- å¯¼å‡ºCSVæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

---

#### `22_è®­ç»ƒTopå› å­æ¨¡å‹.py`
**åŠŸèƒ½**ï¼šæ ¹æ®ICåˆ†æç»“æœç”Ÿæˆé…ç½®æ–‡ä»¶
```bash
python scripts/22_è®­ç»ƒTopå› å­æ¨¡å‹.py --top 50
```
**å‚æ•°**ï¼š
- `--top`ï¼šé€‰æ‹©Top Nä¸ªå› å­ï¼ˆé»˜è®¤50ï¼‰
- `--output`ï¼šè¾“å‡ºé…ç½®æ–‡ä»¶è·¯å¾„

**è¾“å‡º**ï¼š
- `configs/workflow_config_top50.yaml`ï¼ˆæˆ–è‡ªå®šä¹‰ï¼‰

---

### **æ ¸å¿ƒæ‰§è¡Œè„šæœ¬**

#### `ä¸€é”®è¿è¡Œ.py`
**åŠŸèƒ½**ï¼šæ‰§è¡Œå®Œæ•´å·¥ä½œæµï¼ˆè®­ç»ƒ+å›æµ‹+è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šï¼‰
```bash
# ä½¿ç”¨é»˜è®¤é…ç½®
python scripts/ä¸€é”®è¿è¡Œ.py

# ä½¿ç”¨æŒ‡å®šé…ç½®
python scripts/ä¸€é”®è¿è¡Œ.py configs/workflow_config_top50.yaml
```

**æ‰§è¡Œæµç¨‹**ï¼š
1. è¯»å–é…ç½®æ–‡ä»¶
2. åˆå§‹åŒ–Qlib
3. è®­ç»ƒæ¨¡å‹ï¼ˆ2008-2014ï¼‰
4. éªŒè¯æ¨¡å‹ï¼ˆ2015-2016ï¼‰
5. å›æµ‹åˆ†æï¼ˆ2017-2020ï¼‰
6. è‡ªåŠ¨ç”ŸæˆHTMLæŠ¥å‘Šå¹¶æ‰“å¼€æµè§ˆå™¨

**è¾“å‡º**ï¼š
- MLflowå®éªŒè®°å½•ï¼š`mlruns/train_model` å’Œ `mlruns/backtest_analysis`
- HTMLæŠ¥å‘Šï¼š`backtest_report.html`

---

### **ä¼˜åŒ–å·¥å…·**

#### `model_optimization.py`
**åŠŸèƒ½**ï¼šLightGBMå‚æ•°ä¼˜åŒ–
```bash
python scripts/model_optimization.py
```
**åŠŸèƒ½**ï¼š
- ç½‘æ ¼æœç´¢æœ€ä½³å‚æ•°
- äº¤å‰éªŒè¯
- ç”Ÿæˆä¼˜åŒ–æŠ¥å‘Š

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### **é¦–æ¬¡ä½¿ç”¨**
1. è¿è¡Œ `10_æ£€æŸ¥ç¯å¢ƒ.py` ç¡®ä¿ç¯å¢ƒæ­£å¸¸
2. è¿è¡Œ `20_ICåˆ†æ.py` åˆ†æå› å­è´¨é‡
3. è¿è¡Œ `22_è®­ç»ƒTopå› å­æ¨¡å‹.py` ç”Ÿæˆé…ç½®
4. è¿è¡Œ `ä¸€é”®è¿è¡Œ.py` æ‰§è¡Œå®Œæ•´æµç¨‹

### **æ—¥å¸¸ä½¿ç”¨**
- ç›´æ¥è¿è¡Œ `ä¸€é”®è¿è¡Œ.py` è¿›è¡Œå›æµ‹
- ä½¿ç”¨ `result/` ç›®å½•ä¸‹çš„å·¥å…·æŸ¥çœ‹ç»“æœ

### **å‚æ•°è°ƒä¼˜**
1. ä¿®æ”¹ `configs/*.yaml` é…ç½®æ–‡ä»¶
2. è¿è¡Œ `ä¸€é”®è¿è¡Œ.py` æµ‹è¯•æ•ˆæœ
3. ä½¿ç”¨ `model_optimization.py` ä¼˜åŒ–å‚æ•°

## ğŸ”§ æ³¨æ„äº‹é¡¹

1. **ä¸­æ–‡æ–‡ä»¶å**ï¼šæ‰€æœ‰è„šæœ¬ä½¿ç”¨ä¸­æ–‡å‘½åï¼Œä¾¿äºè¯†åˆ«ï¼Œä½†ä¸èƒ½è¢«å…¶ä»–æ¨¡å—import
2. **ç‹¬ç«‹è¿è¡Œ**ï¼šæ¯ä¸ªè„šæœ¬éƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œ
3. **æ•°æ®ä¾èµ–**ï¼šç¡®ä¿ `D:/Data/my_stock/` æœ‰æ•°æ®
4. **ç¯å¢ƒä¾èµ–**ï¼šéœ€è¦æ¿€æ´» `mystock` condaç¯å¢ƒ

## ğŸ“Š è¾“å‡ºæ–‡ä»¶ä½ç½®

- **MLflowå®éªŒ**ï¼š`mlruns/`
- **é…ç½®æ–‡ä»¶**ï¼š`configs/`
- **HTMLæŠ¥å‘Š**ï¼šé¡¹ç›®æ ¹ç›®å½• `backtest_report.html`
- **PNGå›¾è¡¨**ï¼šé¡¹ç›®æ ¹ç›®å½• `backtest_analysis.png`
