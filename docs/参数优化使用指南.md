# LightGBMå‚æ•°ä¼˜åŒ–ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨ `scripts/30_æ¨¡å‹è®­ç»ƒ/31_å‚æ•°ä¼˜åŒ–.py` å¯¹LightGBMæ¨¡å‹è¿›è¡Œè¶…å‚æ•°ä¼˜åŒ–ã€‚è¯¥è„šæœ¬æ”¯æŒï¼š

- âœ… **Alpha158å› å­ä¼˜åŒ–**ï¼ˆé»˜è®¤ï¼Œ158ä¸ªå†…ç½®æŠ€æœ¯å› å­ï¼‰
- âœ… **Top50å› å­ä¼˜åŒ–**ï¼ˆICç­›é€‰çš„50ä¸ªé«˜è´¨é‡å› å­ï¼‰
- âœ… **è‡ªå®šä¹‰å› å­ä¼˜åŒ–**ï¼ˆä»»æ„YAMLé…ç½®æ–‡ä»¶ï¼‰
- âœ… **è´å¶æ–¯ä¼˜åŒ–**ï¼ˆé«˜æ•ˆè¶…å‚æ•°æœç´¢ç®—æ³•ï¼‰
- âœ… **å‘åå…¼å®¹**ï¼ˆä¸æŒ‡å®šé…ç½®æ—¶ä½¿ç”¨Alpha158ï¼‰

---

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼1ï¼šä¼˜åŒ–Alpha158å› å­ï¼ˆé»˜è®¤ï¼‰

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate mystock

# è¿è¡Œä¼˜åŒ–ï¼ˆä½¿ç”¨é»˜è®¤Alpha158é…ç½®ï¼‰
python scripts/30_æ¨¡å‹è®­ç»ƒ/31_å‚æ•°ä¼˜åŒ–.py --n-iter 30

# æŸ¥çœ‹ç»“æœ
ls optimization_results/
```

**é€‚ç”¨åœºæ™¯**ï¼š
- åˆæ¬¡ä½¿ç”¨ï¼Œæƒ³å¿«é€Ÿä½“éªŒå‚æ•°ä¼˜åŒ–
- ä¸éœ€è¦è‡ªå®šä¹‰å› å­ï¼Œä½¿ç”¨Qlibå†…ç½®çš„158ä¸ªæŠ€æœ¯å› å­
- å‘åå…¼å®¹æ—§ç‰ˆè„šæœ¬

**ç”Ÿæˆæ–‡ä»¶**ï¼š
- `optimization_results/best_params_*.json`ï¼šæœ€ä¼˜å‚æ•°
- `optimization_results/optimization_history_*.json`ï¼šä¼˜åŒ–å†å²
- `configs/workflow_config_optimized_csi300.yaml`ï¼šå¯ç›´æ¥ä½¿ç”¨çš„é…ç½®æ–‡ä»¶

---

### æ–¹å¼2ï¼šä¼˜åŒ–Top50å› å­ï¼ˆæ¨èï¼‰

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate mystock

# ä½¿ç”¨Top50å› å­é…ç½®è¿è¡Œä¼˜åŒ–
python scripts/30_æ¨¡å‹è®­ç»ƒ/31_å‚æ•°ä¼˜åŒ–.py \
    --config configs/workflow_config_top50.yaml \
    --n-iter 30

# æŸ¥çœ‹ç»“æœ
cat optimization_results/best_params_*.json
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å·²å®ŒæˆICåˆ†æï¼Œç­›é€‰å‡ºé«˜è´¨é‡å› å­
- éœ€è¦ä¼˜åŒ–ç»è¿‡ICç­›é€‰çš„Top50å› å­ç­–ç•¥
- è¿½æ±‚æ›´å¥½çš„æ€§èƒ½å’Œæ›´ä½çš„è¿‡æ‹Ÿåˆé£é™©

**ç”Ÿæˆæ–‡ä»¶**ï¼š
- `optimization_results/best_params_*.json`ï¼šæœ€ä¼˜å‚æ•°
- `optimization_results/optimization_history_*.json`ï¼šä¼˜åŒ–å†å²
- `configs/workflow_config_top50_optimized.yaml`ï¼šä¼˜åŒ–åçš„Top50é…ç½®

**ä¼˜åŠ¿**ï¼š
- ğŸ“ˆ **è´¨é‡ä¼˜äºæ•°é‡**ï¼š50ä¸ªé«˜ICå› å­ > 158ä¸ªæ™®é€šå› å­
- âš¡ **è®­ç»ƒæ›´å¿«**ï¼šå› å­æ•°é‡å‡å°‘ï¼Œè®­ç»ƒé€Ÿåº¦æå‡çº¦3å€
- ğŸ¯ **é™ä½è¿‡æ‹Ÿåˆ**ï¼šå‡å°‘å†—ä½™ä¿¡æ¯ï¼Œæ¨¡å‹æ³›åŒ–èƒ½åŠ›æ›´å¼º
- ğŸ’¡ **ä¸šç•Œå®è·µ**ï¼šå¤´éƒ¨é‡åŒ–æœºæ„é€šå¸¸ä½¿ç”¨20-80ä¸ªç²¾é€‰å› å­

---

### æ–¹å¼3ï¼šä¼˜åŒ–è‡ªå®šä¹‰å› å­

```bash
# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py \
    --config configs/my_custom_config.yaml \
    --n-iter 50

# ç”Ÿæˆçš„ä¼˜åŒ–é…ç½®
ls configs/my_custom_config_optimized.yaml
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å¼€å‘äº†è‡ªå·±çš„å› å­åº“
- éœ€è¦æµ‹è¯•ä¸åŒçš„å› å­ç»„åˆ
- å¯¹ç‰¹å®šå¸‚åœºæˆ–é£æ ¼è¿›è¡Œå®šåˆ¶åŒ–ä¼˜åŒ–

---

## å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

### æ ¸å¿ƒå‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--config` | str | None | é…ç½®æ–‡ä»¶è·¯å¾„ã€‚å¦‚ä¸æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤Alpha158 |
| `--n-iter` | int | 30 | è´å¶æ–¯ä¼˜åŒ–è¿­ä»£æ¬¡æ•°ã€‚è¶Šå¤šè¶Šç²¾ç¡®ï¼Œä½†è€—æ—¶æ›´é•¿ |
| `--init-points` | int | 5 | åˆå§‹éšæœºæ¢ç´¢ç‚¹æ•°ã€‚å»ºè®®ä¿æŒé»˜è®¤å€¼ |
| `--instruments` | str | csi300 | è‚¡ç¥¨æ± ï¼ˆä»…åœ¨ä¸æŒ‡å®š--configæ—¶æœ‰æ•ˆï¼‰ |

### å‚æ•°é€‰æ‹©å»ºè®®

**è¿­ä»£æ¬¡æ•° (--n-iter)**ï¼š
- `10-20æ¬¡`ï¼šå¿«é€Ÿæµ‹è¯•ï¼Œå¯èƒ½ä¸å¤Ÿå……åˆ†
- `30-50æ¬¡`ï¼šæ—¥å¸¸ä¼˜åŒ–ï¼Œå¹³è¡¡æ•ˆæœä¸æ—¶é—´ï¼ˆæ¨èï¼‰
- `100+æ¬¡`ï¼šç²¾ç»†ä¼˜åŒ–ï¼Œé€‚åˆæœ€ç»ˆç”Ÿäº§ç¯å¢ƒ

**è‚¡ç¥¨æ±  (--instruments)**ï¼š
- `csi300`ï¼šæ²ªæ·±300æˆåˆ†è‚¡ï¼ˆå¤§ç›˜è“ç­¹ï¼‰
- `csi500`ï¼šä¸­è¯500æˆåˆ†è‚¡ï¼ˆä¸­å°ç›˜ï¼‰
- `csi800`ï¼šæ²ªæ·±300+ä¸­è¯500ï¼ˆå…¨å¸‚åœºï¼‰

---

## å·¥ä½œæµç¨‹è¯¦è§£

### å®Œæ•´å·¥ä½œæµ

```mermaid
graph TD
    A[å‡†å¤‡é…ç½®æ–‡ä»¶] --> B[è¿è¡Œå‚æ•°ä¼˜åŒ–]
    B --> C[æŸ¥çœ‹ä¼˜åŒ–ç»“æœ]
    C --> D[ä½¿ç”¨ä¼˜åŒ–é…ç½®è¿è¡Œå›æµ‹]
    D --> E[åˆ†æå›æµ‹ç»“æœ]
```

### è¯¦ç»†æ­¥éª¤

**æ­¥éª¤1ï¼šå‡†å¤‡é…ç½®æ–‡ä»¶**ï¼ˆä»…é™è‡ªå®šä¹‰å› å­ï¼‰

å¦‚æœä½¿ç”¨Top50æˆ–è‡ªå®šä¹‰å› å­ï¼Œç¡®ä¿é…ç½®æ–‡ä»¶åŒ…å«å®Œæ•´çš„handlerå®šä¹‰ï¼š

```yaml
# configs/workflow_config_top50.yaml ç¤ºä¾‹
task:
  dataset:
    kwargs:
      handler:
        class: DataHandlerLP
        module_path: qlib.contrib.data.handler
        kwargs:
          instruments: csi300
          start_time: "2008-01-01"
          end_time: "2020-12-31"
          data_loader:
            class: QlibDataLoader
            kwargs:
              config:
                feature:
                  - ["Alpha#1", "Ref($close, -1) / $close - 1"]
                  - ["Alpha#2", "Ref($volume, -1) / $volume - 1"]
                  # ... æ›´å¤šå› å­å®šä¹‰
                label: ["Ref($close, -2) / Ref($close, -1) - 1"]
```

**æ­¥éª¤2ï¼šè¿è¡Œå‚æ•°ä¼˜åŒ–**

```bash
# è¿è¡Œä¼˜åŒ–ï¼ˆä»¥Top50ä¸ºä¾‹ï¼‰
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py \
    --config configs/workflow_config_top50.yaml \
    --n-iter 30
```

**å®æ—¶è¾“å‡ºç¤ºä¾‹**ï¼š
```
åŠ è½½æ•°æ®é›†...
ä»é…ç½®æ–‡ä»¶è¯»å–handler: configs/workflow_config_top50.yaml
  ä½¿ç”¨é…ç½®ä¸­çš„è‚¡ç¥¨æ± : csi300
  Handlerç±»å‹: DataHandlerLP
[OK] æ•°æ®é›†åŠ è½½å®Œæˆ

å¼€å§‹ä¼˜åŒ–å‚æ•°...
|   iter    |  target   | colsam... | learni... | max_depth | min_ch... | n_esti... | num_le... | subsample |
---------------------------------------------------------------------------------------------------------------------
|  1        |  0.04234  |  0.7512   |  0.0234   |  6.234    |  45.67    |  234.5    |  78.3     |  0.8234   |
|  2        |  0.04567  |  0.8123   |  0.0189   |  7.456    |  38.92    |  267.8    |  82.1     |  0.8567   |
...
[OK] ä¼˜åŒ–å®Œæˆ

æœ€ä¼˜å‚æ•°:
  learning_rate: 0.0189
  n_estimators: 268
  max_depth: 7
  num_leaves: 82
  ...

å·²ä¿å­˜æœ€ä¼˜å‚æ•°: optimization_results/best_params_20251116_143022.json
å·²ä¿å­˜ä¼˜åŒ–å†å²: optimization_results/optimization_history_20251116_143022.json
[OK] å·²ç”Ÿæˆå¯ç”¨é…ç½®æ–‡ä»¶: configs/workflow_config_top50_optimized.yaml

=== ä¸‹ä¸€æ­¥æ“ä½œ ===
   1. æŸ¥çœ‹ä¼˜åŒ–ç»“æœ: cat optimization_results/best_params_20251116_143022.json
   2. ä½¿ç”¨ä¼˜åŒ–åçš„é…ç½®: python scripts/30_è¿è¡Œå·¥ä½œæµ.py configs/workflow_config_top50_optimized.yaml
```

**æ­¥éª¤3ï¼šæŸ¥çœ‹ä¼˜åŒ–ç»“æœ**

```bash
# æŸ¥çœ‹æœ€ä¼˜å‚æ•°
cat optimization_results/best_params_20251116_143022.json

# æŸ¥çœ‹ä¼˜åŒ–å†å²ï¼ˆå¯è§†åŒ–ï¼‰
python -c "
import json
import matplotlib.pyplot as plt

with open('optimization_results/optimization_history_20251116_143022.json') as f:
    history = json.load(f)

plt.figure(figsize=(10, 6))
plt.plot([h['target'] for h in history])
plt.xlabel('Iteration')
plt.ylabel('IC (Information Coefficient)')
plt.title('Optimization Progress')
plt.grid(True)
plt.savefig('optimization_progress.png')
print('å·²ä¿å­˜ä¼˜åŒ–æ›²çº¿: optimization_progress.png')
"
```

**æ­¥éª¤4ï¼šä½¿ç”¨ä¼˜åŒ–é…ç½®è¿è¡Œå›æµ‹**

```bash
# ä½¿ç”¨ä¼˜åŒ–åçš„é…ç½®è¿è¡Œå®Œæ•´å·¥ä½œæµ
python scripts/30_è¿è¡Œå·¥ä½œæµ.py configs/workflow_config_top50_optimized.yaml

# æŸ¥çœ‹å›æµ‹ç»“æœ
python view_results.py
```

**æ­¥éª¤5ï¼šåˆ†æå›æµ‹ç»“æœ**

å…³é”®æŒ‡æ ‡å¯¹æ¯”ï¼š

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿› |
|------|--------|--------|------|
| ICå‡å€¼ | 0.038 | 0.045 | +18.4% |
| IC_IR | 1.12 | 1.35 | +20.5% |
| å¹´åŒ–æ”¶ç›Š | 15.2% | 18.7% | +3.5% |
| æœ€å¤§å›æ’¤ | -12.3% | -10.8% | +1.5% |
| ä¿¡æ¯æ¯”ç‡ | 1.24 | 1.52 | +22.6% |

---

## é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰ä¼˜åŒ–ç©ºé—´

å¦‚éœ€è°ƒæ•´è¶…å‚æ•°æœç´¢èŒƒå›´ï¼Œå¯ä¿®æ”¹ `scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py` ä¸­çš„ `pbounds` å®šä¹‰ï¼š

```python
# é»˜è®¤æœç´¢ç©ºé—´ï¼ˆé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼‰
pbounds = {
    'learning_rate': (0.01, 0.3),      # å­¦ä¹ ç‡
    'n_estimators': (50, 500),         # æ ‘çš„æ•°é‡
    'max_depth': (3, 10),              # æ ‘çš„æ·±åº¦
    'num_leaves': (20, 150),           # å¶å­èŠ‚ç‚¹æ•°
    'min_child_samples': (10, 100),    # å¶å­æœ€å°æ ·æœ¬æ•°
    'subsample': (0.5, 1.0),           # è¡Œé‡‡æ ·ç‡
    'colsample_bytree': (0.5, 1.0)     # åˆ—é‡‡æ ·ç‡
}

# æ¿€è¿›ä¼˜åŒ–ï¼ˆè¿½æ±‚æ›´é«˜æ€§èƒ½ï¼Œå¯èƒ½è¿‡æ‹Ÿåˆï¼‰
pbounds_aggressive = {
    'learning_rate': (0.005, 0.1),     # æ›´å°çš„å­¦ä¹ ç‡
    'n_estimators': (100, 1000),       # æ›´å¤šçš„æ ‘
    'max_depth': (5, 15),              # æ›´æ·±çš„æ ‘
    'num_leaves': (50, 300),           # æ›´å¤šå¶å­èŠ‚ç‚¹
    ...
}

# ä¿å®ˆä¼˜åŒ–ï¼ˆé˜²æ­¢è¿‡æ‹Ÿåˆï¼Œæ›´ç¨³å¥ï¼‰
pbounds_conservative = {
    'learning_rate': (0.02, 0.2),
    'n_estimators': (30, 200),
    'max_depth': (3, 7),               # é™åˆ¶æ ‘æ·±åº¦
    'num_leaves': (15, 80),            # é™åˆ¶å¶å­æ•°
    ...
}
```

### å¤šé…ç½®æ‰¹é‡ä¼˜åŒ–

```bash
# åˆ›å»ºæ‰¹é‡ä¼˜åŒ–è„šæœ¬
cat > batch_optimize.sh <<'EOF'
#!/bin/bash

# ä¼˜åŒ–å¤šä¸ªé…ç½®
for config in configs/workflow_config_*.yaml; do
    echo "ä¼˜åŒ–é…ç½®: $config"
    python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py \
        --config "$config" \
        --n-iter 50
    echo "-----------------------------------"
done

echo "æ‰¹é‡ä¼˜åŒ–å®Œæˆï¼"
EOF

# æ‰§è¡Œæ‰¹é‡ä¼˜åŒ–
chmod +x batch_optimize.sh
./batch_optimize.sh
```

### å¹¶è¡Œä¼˜åŒ–ï¼ˆå¤šè‚¡ç¥¨æ± ï¼‰

```bash
# åŒæ—¶ä¼˜åŒ–CSI300å’ŒCSI500
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --config configs/workflow_config_top50_csi300.yaml --n-iter 30 &
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --config configs/workflow_config_top50_csi500.yaml --n-iter 30 &
wait

echo "å¹¶è¡Œä¼˜åŒ–å®Œæˆ"
```

---

## å¸¸è§é—®é¢˜ (FAQ)

### Q1: Alpha158å’ŒTop50å› å­æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**Alpha158**ï¼š
- Qlibå†…ç½®çš„158ä¸ªæŠ€æœ¯å› å­
- åŒ…å«ä»·æ ¼ã€æˆäº¤é‡ã€æ¢æ‰‹ç‡ç­‰å¤šç»´åº¦ç‰¹å¾
- å¼€ç®±å³ç”¨ï¼Œæ— éœ€è‡ªå®šä¹‰
- é€‚åˆå¿«é€ŸéªŒè¯å’ŒåŸºå‡†æµ‹è¯•

**Top50å› å­**ï¼š
- é€šè¿‡ICåˆ†æç­›é€‰å‡ºçš„50ä¸ªé«˜è´¨é‡å› å­
- åŸºäº `22_è®­ç»ƒTopå› å­æ¨¡å‹.py` çš„ICåˆ†æç»“æœ
- å‰”é™¤äº†ä½ICã€ä¸ç¨³å®šçš„å› å­
- æ€§èƒ½é€šå¸¸ä¼˜äºAlpha158ï¼Œä¸”è®­ç»ƒæ›´å¿«

**å¯¹æ¯”**ï¼š

| ç»´åº¦ | Alpha158 | Top50 |
|------|----------|-------|
| å› å­æ•°é‡ | 158 | 50 |
| ICç­›é€‰ | âŒ | âœ… |
| è®­ç»ƒé€Ÿåº¦ | æ…¢ | å¿«ï¼ˆçº¦3å€ï¼‰ |
| è¿‡æ‹Ÿåˆé£é™© | è¾ƒé«˜ | è¾ƒä½ |
| é€‚ç”¨åœºæ™¯ | åŸºå‡†æµ‹è¯• | ç”Ÿäº§ç¯å¢ƒ |

### Q2: ä¼˜åŒ–éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ

**å…¸å‹è€—æ—¶**ï¼ˆå•æ ¸CPUï¼Œ30æ¬¡è¿­ä»£ï¼‰ï¼š
- Alpha158ï¼šçº¦40-60åˆ†é’Ÿ
- Top50ï¼šçº¦15-25åˆ†é’Ÿï¼ˆå› å­æ•°å°‘ï¼Œè®­ç»ƒå¿«ï¼‰
- è‡ªå®šä¹‰å› å­ï¼šå–å†³äºå› å­æ•°é‡å’Œå¤æ‚åº¦

**åŠ é€Ÿæ–¹æ³•**ï¼š
1. å‡å°‘è¿­ä»£æ¬¡æ•°ï¼ˆ`--n-iter 20`ï¼‰
2. ä½¿ç”¨GPUï¼ˆå¦‚æ”¯æŒï¼‰
3. å‡å°‘å› å­æ•°é‡
4. ç¼©çŸ­è®­ç»ƒå‘¨æœŸï¼ˆä¿®æ”¹train_start/train_endï¼‰

### Q3: ä¼˜åŒ–åçš„å‚æ•°å¯ä»¥ç›´æ¥ç”¨äºç”Ÿäº§å—ï¼Ÿ

**å»ºè®®æµç¨‹**ï¼š

1. âœ… **æ ·æœ¬å¤–éªŒè¯**ï¼šåœ¨testé›†ï¼ˆ2017-2020ï¼‰ä¸ŠéªŒè¯æ€§èƒ½
2. âœ… **æ»šåŠ¨éªŒè¯**ï¼šä½¿ç”¨ä¸åŒæ—¶é—´æ®µéªŒè¯ç¨³å¥æ€§
3. âœ… **å¯¹æ¯”åŸºå‡†**ï¼šä¸æœªä¼˜åŒ–ç‰ˆæœ¬å¯¹æ¯”ï¼Œç¡®è®¤æ”¹è¿›æ˜¾è‘—
4. âš ï¸ **è­¦æƒ•è¿‡æ‹Ÿåˆ**ï¼šå¦‚æœtrain/validè¡¨ç°æå¥½ä½†testå¾ˆå·®ï¼Œå¯èƒ½è¿‡æ‹Ÿåˆ

**éªŒè¯è„šæœ¬ç¤ºä¾‹**ï¼š

```python
# scripts/validate_params.py
import qlib
from qlib.workflow import R
from pathlib import Path

qlib.init(provider_uri='D:/Data/my_stock', region='cn')

# å¯¹æ¯”ä¼˜åŒ–å‰åçš„ç»“æœ
recorder_before = R.get_recorder(experiment_name="before_optimization")
recorder_after = R.get_recorder(experiment_name="after_optimization")

report_before = recorder_before.load_object("portfolio_analysis/report_normal_1day.pkl")
report_after = recorder_after.load_object("portfolio_analysis/report_normal_1day.pkl")

print("ä¼˜åŒ–å‰å¹´åŒ–æ”¶ç›Š:", report_before['excess_return_with_cost'].mean() * 252)
print("ä¼˜åŒ–åå¹´åŒ–æ”¶ç›Š:", report_after['excess_return_with_cost'].mean() * 252)
```

### Q4: å¦‚ä½•åˆ¤æ–­ä¼˜åŒ–æ•ˆæœå¥½åï¼Ÿ

**æ ¸å¿ƒæŒ‡æ ‡**ï¼š

1. **IC (Information Coefficient)**
   - ICå‡å€¼ > 0.03ï¼šä¼˜ç§€
   - ICå‡å€¼ > 0.01ï¼šè‰¯å¥½
   - ICå‡å€¼ < 0.01ï¼šéœ€æ”¹è¿›

2. **IC_IR (ICä¿¡æ¯æ¯”ç‡)**
   - IC_IR > 1.5ï¼šéå¸¸ç¨³å®š
   - IC_IR > 1.0ï¼šç¨³å®š
   - IC_IR < 0.8ï¼šä¸å¤Ÿç¨³å®š

3. **éªŒè¯é›†è¡¨ç°**
   - Valid ICåº”æ¥è¿‘Train ICï¼ˆå·®è·<20%ï¼‰
   - å¦‚Valid ICè¿œä½äºTrain ICï¼Œå¯èƒ½è¿‡æ‹Ÿåˆ

**åˆ¤æ–­æ ‡å‡†**ï¼š

```
âœ… å¥½çš„ä¼˜åŒ–ç»“æœ:
   Train IC = 0.045, Valid IC = 0.042, Test IC = 0.040
   ï¼ˆä¸‰è€…æ¥è¿‘ï¼Œè¯´æ˜æ¨¡å‹æ³›åŒ–èƒ½åŠ›å¼ºï¼‰

âš ï¸ å¯ç–‘çš„ä¼˜åŒ–ç»“æœ:
   Train IC = 0.065, Valid IC = 0.035, Test IC = 0.020
   ï¼ˆTrainè¿œé«˜äºValid/Testï¼Œå¯èƒ½è¿‡æ‹Ÿåˆï¼‰
```

### Q5: ä¼˜åŒ–åçš„é…ç½®æ–‡ä»¶å¯ä»¥ç”¨äºå…¶ä»–è‚¡ç¥¨æ± å—ï¼Ÿ

**å¯ä»¥ï¼Œä½†éœ€æ³¨æ„**ï¼š

1. **ç›´æ¥ä½¿ç”¨**ï¼ˆç›¸åŒå¸‚åœºç‰¹å¾ï¼‰ï¼š
   - CSI300 â†’ CSI800ï¼ˆéƒ½æ˜¯å¤§ç›˜è‚¡ï¼‰
   - CSI500 â†’ CSI1000ï¼ˆéƒ½æ˜¯ä¸­å°ç›˜è‚¡ï¼‰

2. **éœ€é‡æ–°ä¼˜åŒ–**ï¼ˆå¸‚åœºç‰¹å¾ä¸åŒï¼‰ï¼š
   - CSI300 âŒâ†’ CSI500ï¼ˆå¤§ç›˜ vs ä¸­å°ç›˜ï¼‰
   - Aè‚¡ âŒâ†’ æ¸¯è‚¡ï¼ˆä¸åŒå¸‚åœºï¼‰

3. **æœ€ä½³å®è·µ**ï¼šé’ˆå¯¹ç›®æ ‡è‚¡ç¥¨æ± å•ç‹¬ä¼˜åŒ–

```bash
# ä¸ºCSI300ä¼˜åŒ–
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --config configs/workflow_config_top50_csi300.yaml --n-iter 30

# ä¸ºCSI500ä¼˜åŒ–
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --config configs/workflow_config_top50_csi500.yaml --n-iter 30
```

### Q6: ä¼˜åŒ–å†å²æ–‡ä»¶æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

ä¼˜åŒ–å†å² (`optimization_history_*.json`) è®°å½•äº†æ¯æ¬¡è¿­ä»£çš„å‚æ•°å’Œç»“æœï¼Œå¯ç”¨äºï¼š

1. **å¯è§†åŒ–ä¼˜åŒ–è¿‡ç¨‹**ï¼ˆè§"æ­¥éª¤3"ç¤ºä¾‹ä»£ç ï¼‰
2. **åˆ†æå‚æ•°æ•æ„Ÿæ€§**ï¼ˆå“ªäº›å‚æ•°å¯¹ç»“æœå½±å“æœ€å¤§ï¼‰
3. **è°ƒè¯•ä¼˜åŒ–ç®—æ³•**ï¼ˆæ˜¯å¦æ”¶æ•›ã€æ˜¯å¦é™·å…¥å±€éƒ¨æœ€ä¼˜ï¼‰
4. **æå–æ¬¡ä¼˜å‚æ•°**ï¼ˆæœ‰æ—¶ç¬¬2ã€3åå‚æ•°æ›´ç¨³å¥ï¼‰

**å‚æ•°æ•æ„Ÿæ€§åˆ†æç¤ºä¾‹**ï¼š

```python
import json
import pandas as pd

with open('optimization_results/optimization_history_*.json') as f:
    history = json.load(f)

df = pd.DataFrame(history)
print("å‚æ•°ä¸ICçš„ç›¸å…³æ€§:")
print(df[['learning_rate', 'n_estimators', 'max_depth', 'target']].corr()['target'])
```

### Q7: 50ä¸ªå› å­å¤Ÿå—ï¼Ÿä¼šä¸ä¼šå¤ªå°‘ï¼Ÿ

**ä¸šç•Œå®è·µ**ï¼š
- å¤´éƒ¨é‡åŒ–æœºæ„ï¼š20-80ä¸ªç²¾é€‰å› å­
- å­¦æœ¯ç ”ç©¶ï¼š30-100ä¸ªå› å­
- Qlib Alpha158ï¼š158ä¸ªå› å­ï¼ˆåŒ…å«å¾ˆå¤šå†—ä½™ï¼‰

**å…³é”®åŸåˆ™ï¼šè´¨é‡ > æ•°é‡**

50ä¸ªé«˜ICå› å­çš„æ•ˆæœé€šå¸¸ä¼˜äº158ä¸ªæ··åˆè´¨é‡å› å­ï¼ŒåŸå› ï¼š
- âœ… ä¿¡å™ªæ¯”æ›´é«˜
- âœ… å‡å°‘å…±çº¿æ€§
- âœ… é™ä½è¿‡æ‹Ÿåˆ
- âœ… è®­ç»ƒæ›´å¿«

**éªŒè¯æ–¹æ³•**ï¼š
```bash
# å¯¹æ¯”50å› å­ vs 158å› å­
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --config configs/workflow_config_top50.yaml --n-iter 30
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --n-iter 30  # é»˜è®¤Alpha158

# å¯¹æ¯”å›æµ‹ç»“æœ
python scripts/30_è¿è¡Œå·¥ä½œæµ.py configs/workflow_config_top50_optimized.yaml
python scripts/30_è¿è¡Œå·¥ä½œæµ.py configs/workflow_config_optimized_csi300.yaml
```

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜1: æ‰¾ä¸åˆ°é…ç½®æ–‡ä»¶

**é”™è¯¯ä¿¡æ¯**ï¼š
```
FileNotFoundError: é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: configs/workflow_config_top50.yaml
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls configs/workflow_config_top50.yaml

# å¦‚ä¸å­˜åœ¨ï¼Œå…ˆè¿è¡ŒICåˆ†æå’ŒTopå› å­æ¨¡å‹è®­ç»ƒ
python scripts/20_ICåˆ†æ.py
python scripts/22_è®­ç»ƒTopå› å­æ¨¡å‹.py
```

### é—®é¢˜2: ä¼˜åŒ–è¿‡ç¨‹å¡ä½ä¸åŠ¨

**å¯èƒ½åŸå› **ï¼š
- æ•°æ®åŠ è½½æ…¢ï¼ˆé¦–æ¬¡è¿è¡Œéœ€ç¼“å­˜æ•°æ®ï¼‰
- è®­ç»ƒå‘¨æœŸå¤ªé•¿
- å› å­è®¡ç®—å¤æ‚

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. ç­‰å¾…é¦–æ¬¡æ•°æ®ç¼“å­˜å®Œæˆï¼ˆçº¦5-10åˆ†é’Ÿï¼‰
# 2. ç¼©çŸ­è®­ç»ƒå‘¨æœŸæµ‹è¯•
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py \
    --config configs/workflow_config_top50.yaml \
    --n-iter 10  # å‡å°‘è¿­ä»£æ¬¡æ•°

# 3. æ£€æŸ¥ç³»ç»Ÿèµ„æº
htop  # Linux
taskmgr  # Windows
```

### é—®é¢˜3: ä¼˜åŒ–ç»“æœå¾ˆå·®ï¼ˆIC < 0.01ï¼‰

**æ’æŸ¥æ­¥éª¤**ï¼š

1. **æ£€æŸ¥å› å­è´¨é‡**ï¼š
```bash
# æŸ¥çœ‹ICåˆ†æç»“æœ
python scripts/21_ä½¿ç”¨ICç»“æœ.py
```

2. **æ£€æŸ¥æ•°æ®è´¨é‡**ï¼š
```bash
# éªŒè¯æ•°æ®å®Œæ•´æ€§
python scripts/10_æ£€æŸ¥ç¯å¢ƒ.py
```

3. **æ£€æŸ¥ä¼˜åŒ–ç©ºé—´**ï¼š
   - learning_rateæ˜¯å¦å¤ªå¤§ï¼ˆ>0.3ï¼‰
   - n_estimatorsæ˜¯å¦å¤ªå°‘ï¼ˆ<50ï¼‰
   - è€ƒè™‘è°ƒæ•´pbounds

### é—®é¢˜4: å†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯**ï¼š
```
MemoryError: Unable to allocate array
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# 1. å‡å°‘å› å­æ•°é‡ï¼ˆä½¿ç”¨Top30è€ŒéTop50ï¼‰
python scripts/22_è®­ç»ƒTopå› å­æ¨¡å‹.py  # ä¿®æ”¹top_n=30

# 2. ç¼©çŸ­è®­ç»ƒå‘¨æœŸ
# ä¿®æ”¹ train_start/train_end å‚æ•°

# 3. å‡å°‘è‚¡ç¥¨æ± 
--instruments csi300  # è€Œécsi800
```

---

## æœ€ä½³å®è·µ

### 1. è¿­ä»£å¼ä¼˜åŒ–ç­–ç•¥

**ç¬¬ä¸€è½®ï¼šå¿«é€ŸéªŒè¯**
```bash
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --config configs/workflow_config_top50.yaml --n-iter 10
```
- ç›®çš„ï¼šå¿«é€ŸéªŒè¯æµç¨‹å¯è¡Œæ€§
- è€—æ—¶ï¼šçº¦10åˆ†é’Ÿ
- ç»“æœï¼šåˆæ­¥å‚æ•°

**ç¬¬äºŒè½®ï¼šä¸­ç­‰ç²¾åº¦**
```bash
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --config configs/workflow_config_top50.yaml --n-iter 30
```
- ç›®çš„ï¼šè·å¾—è¾ƒå¥½çš„å‚æ•°
- è€—æ—¶ï¼šçº¦20-30åˆ†é’Ÿ
- ç»“æœï¼šç”Ÿäº§å¯ç”¨å‚æ•°

**ç¬¬ä¸‰è½®ï¼šç²¾ç»†ä¼˜åŒ–**ï¼ˆå¯é€‰ï¼‰
```bash
python scripts/å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py --config configs/workflow_config_top50.yaml --n-iter 100
```
- ç›®çš„ï¼šæ¦¨å–æœ€åçš„æ€§èƒ½
- è€—æ—¶ï¼šçº¦1-2å°æ—¶
- ç»“æœï¼šæœ€ä¼˜å‚æ•°

### 2. å‚æ•°ä¿å­˜ä¸ç‰ˆæœ¬ç®¡ç†

```bash
# åˆ›å»ºå‚æ•°ç‰ˆæœ¬ç®¡ç†ç›®å½•
mkdir -p optimization_results/versions

# ä¿å­˜å½“å‰ç‰ˆæœ¬
cp configs/workflow_config_top50_optimized.yaml \
   optimization_results/versions/top50_v1_$(date +%Y%m%d).yaml

# Gitç‰ˆæœ¬æ§åˆ¶
git add optimization_results/versions/
git commit -m "chore: ä¿å­˜Top50ä¼˜åŒ–å‚æ•° v1 (IC=0.045)"
```

### 3. å®šæœŸé‡æ–°ä¼˜åŒ–

å¸‚åœºç‰¹å¾ä¼šéšæ—¶é—´å˜åŒ–ï¼Œå»ºè®®ï¼š
- æ¯å­£åº¦é‡æ–°ä¼˜åŒ–ä¸€æ¬¡å‚æ•°
- æ¯æ¬¡æ·»åŠ æ–°å› å­åé‡æ–°ä¼˜åŒ–
- å¸‚åœºé£æ ¼åˆ‡æ¢åï¼ˆå¦‚ç‰›ç†Šè½¬æ¢ï¼‰é‡æ–°ä¼˜åŒ–

### 4. A/Bæµ‹è¯•

```bash
# ç”Ÿäº§ç¯å¢ƒ
configs/workflow_config_top50_optimized_production.yaml

# æµ‹è¯•ç¯å¢ƒ
configs/workflow_config_top50_optimized_test.yaml

# å¯¹æ¯”æµ‹è¯•
python scripts/30_è¿è¡Œå·¥ä½œæµ.py configs/workflow_config_top50_optimized_production.yaml
python scripts/30_è¿è¡Œå·¥ä½œæµ.py configs/workflow_config_top50_optimized_test.yaml
```

---

## å‚è€ƒèµ„æ–™

### ç›¸å…³æ–‡æ¡£

- [Qlibå®˜æ–¹æ–‡æ¡£](https://qlib.readthedocs.io/)
- [LightGBMå‚æ•°è°ƒä¼˜æŒ‡å—](https://lightgbm.readthedocs.io/en/latest/Parameters-Tuning.html)
- [è´å¶æ–¯ä¼˜åŒ–åŸç†](https://github.com/fmfn/BayesianOptimization)
- [å› å­ICåˆ†ææ–¹æ³•](docs/design/ICåˆ†ææ–¹æ³•è®º.md)

### è„šæœ¬å…³è”

```mermaid
graph LR
    A[20_ICåˆ†æ.py] --> B[22_è®­ç»ƒTopå› å­æ¨¡å‹.py]
    B --> C[å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py]
    C --> D[30_è¿è¡Œå·¥ä½œæµ.py]
    D --> E[view_results.py]
```

**å·¥ä½œæµè¯´æ˜**ï¼š
1. `20_ICåˆ†æ.py`ï¼šè®¡ç®—æ‰€æœ‰å› å­çš„ICå€¼
2. `22_è®­ç»ƒTopå› å­æ¨¡å‹.py`ï¼šç­›é€‰Topå› å­ï¼Œç”Ÿæˆé…ç½®
3. `å‚æ•°ä¼˜åŒ–_æ”¹è¿›ç‰ˆ.py`ï¼šä¼˜åŒ–LightGBMè¶…å‚æ•°
4. `30_è¿è¡Œå·¥ä½œæµ.py`ï¼šè¿è¡Œå®Œæ•´å›æµ‹
5. `view_results.py`ï¼šæŸ¥çœ‹åˆ†æç»“æœ

### è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

1. **æ¨¡å‹é›†æˆ**ï¼š
   - LightGBM + XGBoost + CatBoost
   - Stacking / Blending

2. **ç‰¹å¾å·¥ç¨‹**ï¼š
   - å› å­äº¤å‰ç»„åˆ
   - éçº¿æ€§ç‰¹å¾å˜æ¢
   - è¡Œä¸š/å¸‚å€¼ä¸­æ€§åŒ–

3. **ç­–ç•¥ä¼˜åŒ–**ï¼š
   - åŠ¨æ€è°ƒä»“é¢‘ç‡
   - æ­¢æŸæ­¢ç›ˆè§„åˆ™
   - é£é™©é¢„ç®—ç®¡ç†

---

## é™„å½•ï¼šé…ç½®æ–‡ä»¶æ¨¡æ¿

### Alpha158é…ç½®æ¨¡æ¿

```yaml
# configs/workflow_config_alpha158_template.yaml
qlib_init:
  provider_uri: "D:/Data/my_stock"
  region: cn

market: csi300
benchmark: SH000300

data_handler_config: &data_handler_config
  start_time: "2008-01-01"
  end_time: "2020-12-31"
  fit_start_time: "2008-01-01"
  fit_end_time: "2014-12-31"
  instruments: csi300

task:
  model:
    class: LGBModel
    module_path: qlib.contrib.model.gbdt
    kwargs:
      loss: mse
      # ä»¥ä¸‹å‚æ•°ç”±ä¼˜åŒ–è„šæœ¬è‡ªåŠ¨å¡«å……
      learning_rate: 0.05
      n_estimators: 100
      max_depth: 6
      num_leaves: 64
      ...

  dataset:
    class: DatasetH
    module_path: qlib.data.dataset
    kwargs:
      handler:
        class: Alpha158
        module_path: qlib.contrib.data.handler
        kwargs:
          <<: *data_handler_config
          infer_processors: [...]
          learn_processors: [...]
          label: ["Ref($close, -2) / Ref($close, -1) - 1"]
      segments:
        train: ["2008-01-01", "2014-12-31"]
        valid: ["2015-01-01", "2016-12-31"]
        test: ["2017-01-01", "2020-12-31"]
```

### Top50é…ç½®æ¨¡æ¿

```yaml
# configs/workflow_config_top50_template.yaml
task:
  dataset:
    kwargs:
      handler:
        class: DataHandlerLP
        module_path: qlib.contrib.data.handler
        kwargs:
          <<: *data_handler_config
          data_loader:
            class: QlibDataLoader
            kwargs:
              config:
                feature:
                  - ["Alpha#1", "Ref($close, -1) / $close - 1"]
                  - ["Alpha#2", "Ref($volume, -1) / $volume - 1"]
                  # ... 48ä¸ªæ›´å¤šå› å­
                label: ["Ref($close, -2) / Ref($close, -1) - 1"]
          infer_processors: [...]
          learn_processors: [...]
```

---

## æ›´æ–°æ—¥å¿—

### v2.0 (2025-11-16)
- âœ¨ æ–°å¢ï¼šæ”¯æŒä»»æ„YAMLé…ç½®æ–‡ä»¶
- âœ¨ æ–°å¢ï¼š`--config` å‘½ä»¤è¡Œå‚æ•°
- ğŸ”§ ä¼˜åŒ–ï¼šè‡ªåŠ¨ä»é…ç½®æ–‡ä»¶è¯»å–handler
- ğŸ“ æ–‡æ¡£ï¼šå®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’ŒFAQ

### v1.0 (2025-11-01)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬ï¼šæ”¯æŒAlpha158å› å­ä¼˜åŒ–
- âš¡ ä½¿ç”¨è´å¶æ–¯ä¼˜åŒ–ç®—æ³•

---

## è”ç³»ä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- ğŸ“§ é‚®ä»¶ï¼šyour-email@example.com
- ğŸ’¬ Issueï¼š[GitHub Issues](https://github.com/your-repo/issues)
- ğŸ“– æ–‡æ¡£ï¼š[åœ¨çº¿æ–‡æ¡£](https://your-docs-site.com)

---

**ç¥ä¼˜åŒ–é¡ºåˆ©ï¼** ğŸš€
